{
  "openapi": "3.0.1",
  "info": {
    "title": "CFDI API",
    "description": "API para realizar operaciones con CFDI",
    "version": "1.0.0"
  },
  "paths": {
    "/upload_rfc": {
      "post": {
        "summary": "Upload RFC, private key, and certificate",
        "description": "Sube un RFC, clave privada y certificado. Los campos `claveprivada` y `certificado` deben ser archivos en formato binario.",
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/UploadModel"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Data uploaded and inserted successfully"
          },
          "400": {
            "description": "Missing fields in JSON."
          },
          "401": {
            "description": "The private key password is incorrect."
          },
          "500": {
            "description": "Error saving files or inserting into the database."
          }
        }
      }
    },
    "/request": {
      "post": {
        "summary": "Request CFDI",
        "description": "Solicita CFDIs para un RFC en un rango de fechas.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RequestModel"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Request successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SolicitudRealizadaModel"
                }
              }
            }
          },
          "400": {
            "description": "Missing fields in JSON or invalid RFC/dates."
          },
          "500": {
            "description": "Error inserting into the database."
          }
        }
      }
    },
    "/verify_request/{uuid}": {
      "get": {
        "summary": "Verify CFDI Request Status",
        "description": "Verifica el estado de todas las solicitudes asociadas a un UUID y actualiza el estado si todas están completas.",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "required": true,
            "description": "UUID de la solicitud",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Request status updated successfully"
          },
          "404": {
            "description": "Request not found"
          },
          "500": {
            "description": "Error verifying the requests."
          }
        }
      }
    },
    "/get-invoice/{uuid}": {
      "get": {
        "summary": "Get Invoice",
        "description": "Obtiene los detalles del comprobante basado en el UUID.",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "required": true,
            "description": "UUID del comprobante",
            "schema": {
              "type": "string"
            }
          }
        ],
	"responses": {
		  "200": {
			"description": "Plant response",
			"content": {
			  "application/json": {
				"schema": {
				  "type": "array",
				  "items": {
					"$ref": "#/components/schemas/Plant"
				  }
				}
			  }
			}
		  },
		  "400": {
			"description": "Unexpected error",
			"content": {
			  "application/json": {
				"schema": {
				  "$ref": "#/components/schemas/Error"
				}
			  }
			}
		  },
		  "404": {
			"description": "No vouchers available CFDI",
			"content": {
			  "application/json": {
				"schema": {
				  "$ref": "#/components/schemas/Error"
				}
			  }
			}
		  },
		  "500": {
			"description": "Error querying the database",
			"content": {
			  "application/json": {
				"schema": {
				  "$ref": "#/components/schemas/Error"
				}
			  }
			}
		  }
		}
    },
  "components": {
    "schemas": {
      "UploadModel": {
        "type": "object",
        "required": ["rfc"],
        "properties": {
          "rfc": {
            "type": "string",
            "description": "RFC del contribuyente"
          },
          "private_key": {
            "type": "string",
            "description": "Clave privada en formato PEM"
          },
          "cert": {
            "type": "string",
            "description": "Certificado en formato PEM"
          },
          "password": {
            "type": "string",
            "description": "Contraseña del certificado"
          },
          "ciec": {
            "type": "string",
            "description": "CIEC del contribuyente"
          }
        }
      },
      "RequestModel": {
        "type": "object",
        "required": ["rfc", "startdate", "enddate"],
        "properties": {
          "rfc": {
            "type": "string",
            "description": "RFC del contribuyente"
          },
          "startdate": {
            "type": "string",
            "description": "Fecha de inicio en formato YYYY-MM-DD"
          },
          "enddate": {
            "type": "string",
            "description": "Fecha de fin en formato YYYY-MM-DD"
          }
        }
      },
      "SolicitudRealizadaModel": {
        "type": "object",
        "required": ["uuid", "status"],
        "properties": {
          "uuid": {
            "type": "string",
            "description": "UUID de la solicitud realizada"
          },
          "status": {
            "type": "string",
            "description": "Estado de la solicitud"
          },
          "message": {
            "type": "string",
            "description": "Mensaje relacionado con el estado"
          }
        }
      }
    }
  }
}
